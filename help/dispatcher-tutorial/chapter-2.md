---
title: '"2장 - 디스패처 인프라"'
description: 게시 및 디스패처 토폴로지를 이해합니다. 가장 일반적인 토폴로지 및 설정에 대해 알아봅니다.
feature: Dispatcher
topic: 아키텍처
role: Architect
level: Beginner
source-git-commit: d9714b9a291ec3ee5f3dba9723de72bb120d2149
workflow-type: tm+mt
source-wordcount: '1866'
ht-degree: 0%

---


# 제2장 기반시설

## 캐싱 인프라 설정

이 시리즈의 1장에 게시 시스템과 디스패처의 기본 토폴로지를 도입했습니다. 게시 및 Dispatcher 서버 세트는 예상되는 로드, 데이터 센터의 토폴로지 및 원하는 페일오버 속성에 따라 다양한 변형으로 구성할 수 있습니다.

가장 일반적인 토폴로지를 스케치하고 장점과 단점을 설명할 것입니다. 물론 그 목록은 결코 포괄적이 될 수 없다. 유일한 한계는 너의 상상력이다.

### &quot;레거시&quot; 설정

초기 방문자의 수는 적었고, 하드웨어는 비쌌으며, 웹 서버는 오늘날 비즈니스 크리티컬 서버에 포함되지 않았습니다. 두 개 이상의 게시 시스템 앞에 로드 밸런서 및 캐시가 있는 하나의 Dispatcher가 있는 것이 일반적인 설정입니다. Dispatcher의 핵심에 있는 Apache 서버는 매우 안정적이며 대부분의 설정에서 상당한 양의 요청을 제공할 수 있을 만큼 충분했습니다.

![&quot;기존&quot; Dispatcher 설정 - 오늘날의 표준에서는 그다지 흔하지 않습니다](assets/chapter-2/legacy-dispatcher-setup.png)

*&quot;기존&quot; Dispatcher 설정 - 오늘날의 표준에서는 그다지 흔하지 않습니다*

<br> 

여기에서 디스패처의 이름은 다음과 같습니다.기본적으로 요청을 전달하는 것이었습니다. 이 설정은 오늘날 필요한 성능과 안정성의 높은 요구를 충족할 수 없으므로 더 이상 일반적이지 않습니다.

### 다족 설정

요즘 토폴로지는 좀 다릅니다. 다족 토폴로지에는 게시 서버당 하나의 Dispatcher가 있습니다. 전용(하드웨어) 로드 밸런서는 AEM 인프라 앞에 배치되어 다음 두 개 이상의 다리에 요청을 전달합니다.

![최신 &quot;표준&quot; Dispatcher 설정 - 간편한 처리 및 유지 관리](assets/chapter-2/modern-standard-dispatcher-setup.png)

*최신 &quot;표준&quot; Dispatcher 설정 - 간편한 처리 및 유지 관리*

<br> 

이런 종류의 설정을 위한 이유는 다음과 같습니다

1. 평균적으로 웹 사이트는 과거에 비해 훨씬 많은 트래픽을 제공합니다. 따라서 &quot;Apache 인프라&quot;를 확장할 필요가 있습니다.

2. &quot;레거시&quot; 설정은 Dispatcher 수준에서 중복성을 제공하지 않았습니다. Apache 서버가 다운된 경우 전체 웹 사이트에 연결할 수 없었습니다.

3. Apache 서버는 저렴합니다. 오픈 소스를 기반으로 하며 가상 데이터 센터가 있는 경우 매우 빠르게 프로비저닝될 수 있습니다.

4. 이 설정을 사용하면 &quot;롤링&quot; 또는 &quot;시차를 두고&quot; 업데이트 시나리오를 쉽게 만들 수 있습니다. 게시 1. 설치가 완료되고 내부 네트워크에서 엄격한 연기 테스트 게시 1이 있는 경우 Dispatcher 1에서 캐시를 지우고 Dispatcher 2를 유지 보수하기 위해 제거하는 동안 다시 시작합니다.

5. 이 설정에서 캐시 무효화는 매우 쉽고 결정적입니다. 하나의 게시 시스템만 하나의 Dispatcher에 연결되므로 무효화할 Dispatcher가 하나만 있습니다. 무효화의 순서 및 타이밍은 매우 작습니다.

### &quot;확장&quot; 설정

Apache 서버는 가격이 저렴하고 제공이 간편하므로, 확장 속도를 좀 더 높여 보십시오. 각 게시 서버 앞에 둘 이상의 Dispatcher가 없는 이유는 무엇입니까?

![&quot;Scale Out&quot; 설정 - 애플리케이션 영역도 있지만 제한 사항과 주의 사항도 있습니다](assets/chapter-2/scale-out-setup.png)

*&quot;Scale Out&quot; 설정 - 애플리케이션 영역도 있지만 제한 사항과 주의 사항도 있습니다*

<br> 

꼭 그렇게 하세요! 그리고 그 설정을 위한 많은 유효한 응용 시나리오들이 있습니다. 그러나 고려해야 할 몇 가지 제한 사항과 복잡성도 있습니다.

#### 무효화

각 게시 시스템은 다수의 Dispatcher에 연결되며, 컨텐츠가 변경되면 각 Dispatcher가 무효화되어야 합니다.

#### 유지 관리

Dispatcher 및 Publish 시스템의 초기 구성이 약간 더 복잡하다는 것은 말할 필요도 없습니다. 그러나 &quot;연속&quot; 릴리스의 노력 또한 약간 더 높다는 것을 또한 기억하십시오. AEM 시스템을 실행하는 동안 업데이트할 수 있으며 업데이트해야 합니다. 하지만 적극적으로 요청에 응하면서 그렇게 하지 않는 것이 좋다. 일반적으로 게시 시스템의 일부만 업데이트하려고 하지만 다른 시스템은 여전히 트래픽을 제공하고 테스트 후에는 다른 부분으로 전환해야 합니다. 운이 좋아서 배포 프로세스에서 로드 밸런서에 액세스할 수 있는 경우 여기에서 유지 관리 중인 서버에 대한 라우팅을 비활성화할 수 있습니다. 직접 액세스할 수 없는 공유 로드 밸런서에 있는 경우 업데이트할 게시의 디스패처를 종료하는 것이 좋습니다. 많을수록 문을 닫아야 한다. 많은 수가 있고 업데이트를 자주 계획하고 있는 경우 일부 자동화가 권장됩니다. 자동화 도구가 없다면, 크기 조절은 나쁜 생각입니다.

이전 프로젝트에서 로드 밸런서 자체에 직접 액세스할 필요 없이 로드 밸런싱에서 게시 시스템을 제거하는 다른 방법을 사용했습니다.

로드 밸런서는 일반적으로 서버가 작동 중인지 확인하는 특정 페이지인 &quot;ping&quot;을 수행합니다. 사소한 선택은 보통 홈페이지를 핑하는 것이다. 그러나 ping을 사용하여 로드 밸런서에 트래픽 균형을 맞추지 않도록 신호를 보내려면 다른 항목을 선택합니다. `"up"` 또는 `"down"`(본문 또는 http 응답 코드)로 응답하도록 구성할 수 있는 전용 템플릿 또는 서블릿을 만듭니다. 해당 페이지의 응답은 물론 디스패처에서 캐시해서는 안 됩니다. 따라서 항상 게시 시스템에서 새로 가져옵니다. 이제 로드 밸런서를 구성하여 이 템플릿이나 서블릿을 확인하면 게시 가 다운된 것처럼 만들 수 있습니다. 로드 밸런싱에 포함되지 않으며 업데이트할 수 있습니다.

#### 전 세계 배포

&quot;전 세계 배포&quot;는 각 게시 시스템 앞에 여러 Dispatcher가 있는 &quot;확장&quot; 설정이며 현재 전 세계에 배포되어 고객에게 더 가까운 위치에서 더 나은 성능을 제공합니다. 물론 이 시나리오에는 중앙 로드 밸런서가 없지만 DNS 및 지역 IP 기반 로드 밸런싱 방식이 있습니다.

>[!NOTE]
>
>실제로 이러한 접근 방식으로 CDN(Content Distribution Network)의 종류를 만들고 있으므로, 직접 구축하지 않고 기본 CDN 솔루션을 구입하는 것을 고려해야 합니다. 사용자 지정 CDN을 작성하고 유지 관리하는 것은 사소한 작업이 아닙니다.

#### 가로 크기 조절

로컬 데이터 센터에서도 각 게시 시스템 앞에 여러 Dispatcher가 있는 &quot;확장&quot; 토폴로지는 몇 가지 이점이 있습니다. 높은 트래픽(및 양호한 캐시 적중률)으로 인해 Apache 서버에서 성능 병목 현상이 발생하여 더 이상 하드웨어를 확장할 수 없는 경우(CPU, RAM 및 빠른 디스크 추가) Dispatcher를 추가하여 성능을 높일 수 있습니다. 이를 &quot;가로 크기 조절&quot;이라고 합니다. 하지만 여기에는 제한이 있습니다. 특히 트래픽을 자주 무효화할 때 이 제한이 있습니다. 그 효과를 다음 섹션에 설명하겠습니다.

#### 확장 토폴로지 제한

프록시 서버를 추가하면 일반적으로 성능이 향상됩니다. 그러나 서버를 추가하면 실제로 성능이 저하될 수 있는 시나리오가 있습니다. 어떻게? 매분 새로운 기사와 페이지를 소개하는 뉴스 포털이 있다고 생각해 보세요. Dispatcher는 &quot;자동 무효화&quot;로 무효화를 무효화합니다.페이지가 게시될 때마다 동일한 사이트에 있는 캐시의 모든 페이지가 무효화됩니다. 이 기능은 유용한 기능입니다. 이 기능은 이 시리즈의 [1장](chapter-1.md)에서 다룹니다. 그러나 웹 사이트에서 자주 변경되는 사항이 있으면 캐시를 자주 무효화하는 것입니다. 게시 인스턴스당 하나의 Dispatcher만 있는 경우 페이지를 요청하는 첫 번째 방문자가 해당 페이지의 다시 캐싱을 트리거합니다. 두 번째 방문자가 이미 캐시된 버전을 가져옵니다.

Dispatcher가 두 개 있는 경우 두 번째 방문자는 페이지가 캐시되지 않을 가능성이 50%이며 해당 페이지가 다시 렌더링될 때 더 큰 지연을 경험합니다. 게시당 Dispatcher가 더 많이 있으면 상황이 더 나빠집니다. 어떤 일이 발생하는지를 알려면 게시 서버가 각 Dispatcher에 대해 페이지를 별도로 다시 렌더링해야 하므로 더 많은 로드를 수신합니다.

![캐시 플러시가 빈번한 확장 시나리오에서 성능이 저하됩니다.](assets/chapter-2/decreased-performance.png)

*캐시 플러시가 빈번한 확장 시나리오에서 성능이 저하됩니다.*

<br> 

#### 과도한 크기 조절 문제 해결

모든 Dispatcher에 대해 중앙 공유 저장소를 사용하거나 Apache 서버의 파일 시스템을 동기화하여 문제를 줄일 수 있습니다. 제한된 직접 체험만 제공할 수 있지만, 이렇게 하면 시스템의 복잡성이 가중되고 새로운 수준의 오류가 발생할 수 있습니다.

NFS에서 몇 가지 테스트를 수행했지만 NFS에서는 컨텐츠 잠금 때문에 큰 성능 문제가 발생합니다. 이것은 실제로 전반적인 성과를 감소시켰습니다.

**결론**  - 여러 디스패처 간에 공통 파일 시스템을 공유하는 것은 권장되는 방법이 아닙니다.

성능 문제가 발생하는 경우 게시자 인스턴스에서 최고 로드를 방지하기 위해 게시 및 Dispatcher를 균일하게 확장합니다. 게시/디스패처 비율에는 황금률이 없습니다. 이 규칙은 요청의 배포, 게시물 및 캐시 무효화의 빈도에 따라 매우 다릅니다.

방문자 경험의 지연도 걱정되는 경우 컨텐츠 전달 네트워크 사용, 캐시 다시 가져오기, 사전 캐시 준비, 이 시리즈의 [1장](chapter-1.md)에 설명된 대로 유예 시간을 설정하거나 [부분 3](chapter-3.md)에 대한 일부 고급 아이디어를 참조하십시오.

### &quot;Cross Connected&quot; 설정

우리가 가끔 본 또 다른 설정은 &quot;상호 연결된&quot; 설정입니다.게시 인스턴스에는 전용 Dispatcher가 없지만 모든 Dispatcher가 모든 게시 시스템에 연결됩니다.

![상호 연결된 토폴로지:중복성 및 복잡성 증가](assets/chapter-2/cross-connected-setup.png)

<br> 

*상호 연결된 토폴로지:중복성 및 복잡성 증가*

우선, 이는 비교적 적은 예산을 위해 보다 많은 중복성을 제공합니다. Apache 서버 중 하나가 중단되더라도 렌더링 작업을 수행하는 두 개의 Publish 시스템이 있을 수 있습니다. 또한 게시 시스템 중 하나가 충돌하는 경우 캐시된 로드를 제공하는 2개의 Dispatcher가 여전히 있습니다.

그러나 이는 가격과 함께 제공됩니다.

첫째, 유지보수를 위해 한쪽 다리를 빼는 것은 꽤 번거롭다. 사실, 이것은 이 계획이 설계된 것입니다.더욱 탄력적이고, 가능한 모든 방법으로 가동과 운영을 지속하기 위해. 우리는 이 문제를 어떻게 처리할 것인지에 대한 복잡한 유지 관리 계획을 보았습니다. Dispatcher 2를 먼저 다시 구성하여 교차 연결을 제거합니다. Dispatcher 2를 다시 시작합니다. Dispatcher 1을 종료하고 게시 1, 업데이트.. 등을 업데이트합니다. 2개 이상의 다리로 크기가 조절되면 주의 깊게 고려해야 합니다. 결론은, 그것은 사실 복잡성과 비용 그리고 인간의 실수에 대한 가공할 원천을 증가시킨다는 것입니다. 이를 자동화하는 것이 가장 좋습니다. 따라서 프로젝트 일정에 이 자동화 작업을 포함시킬 인력을 실제로 보유하고 있다면 더 잘 확인해 보십시오. 하드웨어 비용을 절감할 수 있지만 IT 직원에게 비용을 두 배로 지출할 수도 있습니다.

둘째, 로그인이 필요한 AEM에서 일부 사용자 애플리케이션을 실행할 수 있습니다. 고정 세션을 사용하여 해당 인스턴스에서 세션 상태를 유지할 수 있도록 한 명의 사용자가 항상 동일한 AEM 인스턴스에서 제공되도록 합니다. 이러한 교차 연결 설정이 있으면 고정 세션이 로드 밸런서와 Dispatcher에서 제대로 작동하는지 확인해야 합니다. 불가능하지는 않지만, 이를 알고 추가 구성 및 테스트 시간을 추가할 필요가 있습니다. 이는 하드웨어를 절약함으로써 계획한 비용을 절감할 수 있습니다.

### 결론

이 상호 연결 체계를 기본 옵션으로 사용하는 것은 권장되지 않습니다. 그러나 이 기능을 사용하려는 경우 위험 요소와 숨겨진 비용을 신중하게 평가하고 구성 자동화를 프로젝트의 일부로 포함시킬 계획입니다.

## 다음 단계

* [3 - 고급 캐싱 항목](chapter-3.md)
